/*!
 * Validetta (https://github.com/hsnaydd/validetta)
 * Version 2.0.0-beta (18-02-2017 23:22)
 * Licensed under MIT (https://github.com/hsnaydd/validetta/blob/master/LICENCE)
 * Copyright 2013-2017 Hasan AydoÄŸdu <hsnaydd@gmail.com>
 */

!function(){"use strict";var e={},t={},r=new RegExp(/^([a-zA-Z]+)\[([\w\[\]]+)\]/i),a=new RegExp(/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/),n=new RegExp(/^[\-\+]?(\d+|\d+\.?\d+)$/),i={required:"This field is required. Please be sure to check.",email:"Your E-mail address appears to be invalid. Please be sure to check.",number:"You can enter only numbers in this field.",maxLength:"Maximum {count} characters allowed!",minLength:"Minimum {count} characters allowed!",maxChecked:"Maximum {count} options allowed. Please be sure to check.",minChecked:"Please select minimum {count} options.",maxSelected:"Maximum {count} selection allowed. Please be sure to check.",minSelected:"Minimum {count} selection allowed. Please be sure to check.",notEqual:"Fields do not match. Please be sure to check.",different:"Fields cannot be the same as each other",creditCard:"Invalid credit card number. Please be sure to check."},s={showErrorMessages:!0,display:"bubble",errorTemplateClass:"validetta-bubble",errorClass:"validetta-error",validClass:"validetta-valid",bubblePosition:"right",bubbleGapX:15,bubbleGapY:0,realTime:!1,realTimeEvents:"change blur",onValid:function(){},onError:function(){},validators:{}},o=function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,""):e},l=function(e){for(var t=0,r=0;r<e.length;r++)e[r].checked&&t++;return t},d=function(e,t,r){for(var a=t.split(" "),n=0;n<a.length;n++)for(var i=0;i<e.length;i++)e[i].addEventListener(a[n],r)},c=function(e,t){var r,a={};for(r in e)e.hasOwnProperty(r)&&(a[r]=e[r]);for(r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);return a},u=function(e){var t;if("select-multiple"===e.type){t=[];for(var r=0;r<e.length;r++)e.options[r].selected&&t.push(e.options[r].value)}else t=e.value;return t},h=function(e,t,r){var a=document.createEvent("HTMLEvents");a.initEvent(t,!!r,!0),e.dispatchEvent(a)},p=function(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})},f=function(e){try{return JSON.parse(e)}catch(t){return e}};e=function(e,t,r){"undefined"!=typeof r&&(i=c(i,r)),this.handler=!1,this.options=c(s,t),this.scopeOptions={},this.form=e,this.xhr={},this.events()},e.prototype={constructor:e,validator:{required:function(e,t){switch(e.el.type){case"checkbox":return e.el.checked||i.required;case"radio":return this.radio.call(t,e.el)||i.required;case"select-multiple":return null!==e.val||i.required;default:return!!e.val||i.required}},email:function(e){return a.test(e.val)||i.email},number:function(e){return n.test(e.val)||i.number},minLength:function(e){var t=e.val.length;return 0===t||t>=e.arg||i.minLength.replace("{count}",e.arg)},maxLength:function(e){return e.val.length<=e.arg||i.maxLength.replace("{count}",e.arg)},equalTo:function(e,t){return t.form[e.arg].value===e.val||i.notEqual},different:function(e,t){return t.form[e.arg].value!==e.val||i.different},creditCard:function(e){if(""===e.val)return!0;var t,r,a,n=0,s=new RegExp(/[^0-9]+/g),o=e.val.replace(s,""),l=o.length;if(l<16)return i.creditCard;for(var d=0;d<l;d++)t=l-d,r=parseInt(o.substring(t-1,t),10),d%2===1?(a=2*r,a>9&&(a=1+(a-10))):a=r,n+=a;return n>0&&n%10===0||i.creditCard},maxChecked:function(e,t){var r=t.form.querySelectorAll('[name="'+e.el.name+'"]:not([disabled])');if(r[0]===e.el){var a=l(r);if(0!==a)return a<=e.arg||i.maxChecked.replace("{count}",e.arg)}},minChecked:function(e,t){var r=t.form.querySelectorAll('[name="'+e.el.name+'"]:not([disabled])');if(r[0]===e.el){var a=l(r);return a>=e.arg||i.minChecked.replace("{count}",e.arg)}},maxSelected:function(e){if(null!==e.val)return e.val.length<=e.arg||i.maxSelected.replace("{count}",e.arg)},minSelected:function(e){return null!==e.val&&e.val.length>=e.arg||i.minSelected.replace("{count}",e.arg)},radio:function(e){var t=this.form.querySelectorAll('[name="'+e.name+'"]:checked').length;return 1===t},pattern:function(e,t){var r=t.options.validators.pattern[e.arg],a=new RegExp(r.pattern);return a.test(e.val)||r.errorMessage},remote:function(e){e.remote=e.arg},callback:function(e,t){var r=t.options.validators.callback[e.arg];return r.callback(e.el,e.val)||r.errorMessage}},events:function(){var e=this;this.form.addEventListener("submit",function(r){return t=this.querySelectorAll("[data-validetta]"),e.init(r)}),this.options.realTime===!0&&(d(this.form.querySelectorAll("[data-validetta]:not([type=checkbox])"),this.options.realTimeEvents,function(r){return t=[this],e.init(r)}),d(this.form.querySelectorAll("[data-validetta][type=checkbox]"),"click",function(r){return t=e.form.querySelectorAll('[data-validetta][type=checkbox][name="'+this.name+'"]'),e.init(r)})),this.form.addEventListener("reset",function(){return e.reset(this.querySelectorAll("[data-validetta]"))})},init:function(e){if(this.reset(t),this.checkFields(e),"submit"===e.type)return"pending"===this.handler?e.preventDefault():this.handler===!0?(this.options.onError.call(this,e),e.preventDefault()):this.options.onValid.call(this,e)},checkFields:function(e){var a=this;this.invalidFields=[];for(var n=0,i=t.length;n<i;n++)if(!t[n].disabled){var s,l=t[n],d="",c=o(u(l)),h=l.getAttribute("data-validetta").split(",");this.generateScopeOptions(l),this.tmp={},this.tmp={el:l,val:c,parent:this.parents(l)};for(var p=0,f=h.length;p<f;p++){var m,v=h[p].match(r);if(null!==v?("undefined"!=typeof v[2]&&(this.tmp.arg=v[2]),m=v[1]):m=h[p],(""!==c||"required"===m||"equalTo"===m)&&a.validator.hasOwnProperty(m)&&(s=a.validator[m](a.tmp,a),"undefined"!=typeof s&&s!==!0)){var g=l.getAttribute("data-vd-message-"+m);null!==g&&(s=g),d+=s+"<br/>"}}""!==d?(this.setInvalidField(l,d),this.window.open.call(this,l,d)):"undefined"!=typeof this.tmp.remote?this.checkRemote(l,e):("undefined"!=typeof s&&this.addValidClass(this.tmp.parent),s=void 0),this.scopeOptions={}}},checkRemote:function(e,t){var r={},a={},n=e.name||e.id;"undefined"==typeof this.remoteCache&&(this.remoteCache={}),a[n]=this.tmp.val,r=c({data:a},this.options.validators.remote[this.tmp.remote]||{});var i=n+":"+this.tmp.val,s=this.remoteCache[i];if("undefined"!=typeof s)switch(s.state){case"pending":this.handler="pending",s.event=t.type;break;case"rejected":throw t.preventDefault(),new Error(s.result.message);case"resolved":s.result.valid===!1?(this.addErrorClass(this.tmp.parent),this.setInvalidField(e,s.result.message),this.window.open.call(this,e,s.result.message)):this.addValidClass(this.tmp.parent)}else{var o=this.xhr[n];"undefined"!=typeof o&&4!==o.readyState&&o.abort(),s=this.remoteCache[i]={state:"pending",event:t.type},this.remoteRequest(r,s,e,n)}},remoteRequest:function(e,t,r,a){var n=this;this.tmp.parent.classList.add("validetta-pending");var i=new XMLHttpRequest;i.open(e.type,e.url,!0),"POST"===e.type.toUpperCase()&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onload=function(){if(i.status>=200&&i.status<400){var e=i.responseText;"object"!=typeof e&&(e=JSON.parse(e)),t.state="resolved",t.result=e,"submit"===t.event?(n.handler=!1,h(n.form,"submit")):e.valid===!1?(n.addErrorClass(n.tmp.parent),n.triggerError(r,e.message)):n.addValidClass(n.tmp.parent)}else if(0!==i.status){var s="Ajax request failed for field ("+a+"): "+i.status+" "+i.statusText;throw t.state="rejected",t.result={valid:!1,message:s},new Error(s)}n.tmp.parent.classList.remove("validetta-pending")},i.onerror=function(){var e="There was a connection error of some sort";throw t.state="rejected",t.result={valid:!1,message:e},new Error(e)},this.xhr[a]=i,this.xhr[a].send(a+"="+e.data[a]),this.handler="pending"},window:{open:function(e,t){if(!this.scopeOptions.showErrorMessages)return void(this.handler=!0);var r=this.parents(e);if(this.addErrorClass(r),"undefined"==typeof r&&(r=e[0].parentNode),!r.querySelectorAll("."+this.options.errorTemplateClass).length){var a=document.createElement("span");if(a.className=this.options.errorTemplateClass,a.innerHTML=t,r.appendChild(a),"bubble"===this.options.display){var n=0,i=0,s="left"===this.scopeOptions.bubblePosition?-1:1,o="top"===this.scopeOptions.bubblePosition?-1:1;switch(a.classList.add(this.options.errorTemplateClass+"--"+this.scopeOptions.bubblePosition),this.scopeOptions.bubblePosition){case"top":case"bottom":i=e.offsetHeight;break;case"left":n=a.offsetWidth;break;default:n=e.offsetWidth}a.style.top=e.offsetTop+(i+this.scopeOptions.bubbleGapY)*o+"px",a.style.left=e.offsetLeft+(n+this.scopeOptions.bubbleGapX)*s+"px"}this.handler=!0}},close:function(e){var t=this.parents(e);t.classList.remove(this.options.errorClass,this.options.validClass);var r=t.getElementsByClassName(this.options.errorTemplateClass)[0];"undefined"!=typeof r&&t.removeChild(r)}},generateScopeOptions:function(e){for(var t=e.attributes,r={},a=0;a<t.length;a++)"data-vd"===t[a].name.substring(0,7)&&(r[p(t[a].name.substring(8))]=f(t[a].value));this.scopeOptions=c(this.options,r)},reset:function(e){if(this.handler=!1,"undefined"!=typeof e)if("undefined"==typeof e.length)this.window.close.call(this,e);else for(var t=0;t<e.length;t++)this.window.close.call(this,e[t])},addErrorClass:function(e){e.classList.add(this.options.errorClass)},addValidClass:function(e){e.classList.add(this.options.validClass)},getInvalidFields:function(){return this.invalidFields},setInvalidField:function(e,t){this.invalidFields.push({field:e,errors:t})},parents:function(e){for(var t=parseInt(e.getAttribute("data-vd-parent-up"),10)||0,r=0;r<=t;r++)e=e.parentNode;return e},triggerError:function(e,t){this.generateScopeOptions(e),this.reset(e),this.window.open.call(this,e,t),this.scopeOptions={}}},"undefined"!=typeof window.VALIDETTA_LANGUAGE&&(i=c(i,window.VALIDETTA_LANGUAGE)),window.Validetta=e}();